<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­—æ¯ç‹å›½ - KidsEnglish</title>
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
      <div class="logo">
        <span class="logo-icon">ğŸ¼</span>
        <span>KidsEnglish</span>
      </div>
      <div style="display: flex; gap: 15px; align-items: center;">
        <div class="progress-bar">
          <span>â­</span>
          <span class="star-count">0</span>
        </div>
        <button class="back-btn" onclick="goBack()">â† è¿”å›</button>
      </div>
    </header>

    <!-- æ¨¡å—æ ‡é¢˜ -->
    <div class="module-header">
      <h1 class="module-title" style="color: var(--primary-blue);">ğŸ…°ï¸ å­—æ¯ç‹å›½</h1>
      <p>ç‚¹å‡»å­—æ¯å¡ç‰‡ï¼Œå­¦ä¹ å­—æ¯å‘éŸ³ï¼</p>
      
      <!-- æ¨¡å¼é€‰æ‹© -->
      <div class="mode-selector">
        <button class="mode-btn parent active" onclick="setMode('parent')">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ äº²å­æ¨¡å¼</button>
        <button class="mode-btn kid" onclick="setMode('kid')">ğŸ‘¶ ç‹¬ç«‹æ¨¡å¼</button>
      </div>
    </div>

    <!-- å­—æ¯ç½‘æ ¼ -->
    <div class="alphabet-grid" id="alphabetGrid">
      <!-- å­—æ¯å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <script src="../data/content.js"></script>
  <script src="../js/main.js"></script>
  <script>
    let currentMode = 'parent';
    let learnedLetters = new Set();

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', () => {
      renderAlphabet();
      loadProgress();
    });

    // æ¸²æŸ“å­—æ¯è¡¨
    function renderAlphabet() {
      const grid = document.getElementById('alphabetGrid');
      grid.innerHTML = '';
      
      alphabetData.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'letter-card fade-in';
        card.style.animationDelay = `${index * 0.05}s`;
        card.innerHTML = `
          <div class="letter">${item.letter}</div>
          <div class="letter-word">${item.word}</div>
          <div class="letter-icon">${item.icon}</div>
        `;
        card.onclick = () => learnLetter(item, card);
        grid.appendChild(card);
      });
    }

    // å­¦ä¹ å­—æ¯
    function learnLetter(item, card) {
      SoundManager.playClick();
      
      // æ’­æ”¾å­—æ¯å‘éŸ³
      SpeechManager.speak(item.letter);
      
      // å»¶è¿Ÿæ’­æ”¾å•è¯
      setTimeout(() => {
        SpeechManager.speak(`${item.letter} for ${item.word}`);
      }, 1000);
      
      // æ ‡è®°ä¸ºå·²å­¦ä¹ 
      if (!learnedLetters.has(item.letter)) {
        learnedLetters.add(item.letter);
        card.style.borderColor = 'var(--primary-green)';
        
        // æ¯å­¦ä¹ 5ä¸ªå­—æ¯å¥–åŠ±ä¸€é¢—æ˜Ÿ
        if (learnedLetters.size % 5 === 0) {
          ProgressManager.addStars(1);
          showEncouragement();
        }
        
        // ä¿å­˜è¿›åº¦
        saveProgress();
      }
      
      // æ·»åŠ åŠ¨ç”»æ•ˆæœ
      card.style.transform = 'scale(1.1)';
      setTimeout(() => {
        card.style.transform = '';
      }, 200);
    }

    // è®¾ç½®å­¦ä¹ æ¨¡å¼
    function setMode(mode) {
      SoundManager.playClick();
      currentMode = mode;
      
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // æ ¹æ®æ¨¡å¼è°ƒæ•´æç¤º
      if (mode === 'parent') {
        showParentGuide();
      }
    }

    // æ˜¾ç¤ºå®¶é•¿å¼•å¯¼
    function showParentGuide() {
      ModalManager.show(
        'äº²å­æ¨¡å¼',
        'å®¶é•¿å¯ä»¥å¼•å¯¼å­©å­ï¼š\n1. å…ˆè®©å­©å­çœ‹å­—æ¯å’Œå›¾æ¡ˆ\n2. å¤§å£°è¯»å‡ºå­—æ¯å’Œå•è¯\n3. é¼“åŠ±å­©å­è·Ÿè¯»\n4. åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­å¯»æ‰¾è¿™äº›å­—æ¯',
        'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§'
      );
    }

    // æ˜¾ç¤ºé¼“åŠ±
    function showEncouragement() {
      const messages = [
        'å¤ªæ£’äº†ï¼ç»§ç»­åŠ æ²¹ï¼',
        'ä½ çœŸèªæ˜ï¼',
        'åšå¾—å¥½ï¼',
        'è¶…çº§å‰å®³ï¼'
      ];
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      
      // åˆ›å»ºé¼“åŠ±æç¤º
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, var(--primary-yellow) 0%, var(--primary-orange) 100%);
        color: var(--text-dark);
        padding: 30px 50px;
        border-radius: 20px;
        font-size: 28px;
        font-weight: 800;
        box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        z-index: 1000;
        animation: fadeIn 0.3s;
      `;
      toast.textContent = `â­ ${randomMessage}`;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 2000);
    }

    // ä¿å­˜è¿›åº¦
    function saveProgress() {
      const progress = Math.round((learnedLetters.size / 26) * 100);
      ProgressManager.setProgress('alphabet', progress);
      localStorage.setItem('kidsEnglish_learnedLetters', JSON.stringify([...learnedLetters]));
    }

    // åŠ è½½è¿›åº¦
    function loadProgress() {
      const saved = localStorage.getItem('kidsEnglish_learnedLetters');
      if (saved) {
        learnedLetters = new Set(JSON.parse(saved));
        // æ›´æ–°å·²å­¦ä¹ å­—æ¯çš„æ ·å¼
        document.querySelectorAll('.letter-card').forEach((card, index) => {
          if (learnedLetters.has(alphabetData[index].letter)) {
            card.style.borderColor = 'var(--primary-green)';
          }
        });
      }
    }

    // è¿”å›å¤§å…
    function goBack() {
      SoundManager.playClick();
      window.location.href = '../hall.html';
    }
  </script>
</body>
</html>
