<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å•è¯ä¹å›­ - KidsEnglish</title>
  <link rel="stylesheet" href="../css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
      <div class="logo">
        <span class="logo-icon">ğŸ¼</span>
        <span>KidsEnglish</span>
      </div>
      <div style="display: flex; gap: 15px; align-items: center;">
        <div class="progress-bar">
          <span>â­</span>
          <span class="star-count">0</span>
        </div>
        <button class="back-btn" onclick="goBack()">â† è¿”å›</button>
      </div>
    </header>

    <!-- æ¨¡å—æ ‡é¢˜ -->
    <div class="module-header">
      <h1 class="module-title" style="color: var(--primary-green);">ğŸ¶ å•è¯ä¹å›­</h1>
      <p>é€‰æ‹©ç±»åˆ«ï¼Œå­¦ä¹ æœ‰è¶£çš„å•è¯ï¼</p>
    </div>

    <!-- ç±»åˆ«é€‰æ‹© -->
    <div class="words-categories">
      <button class="category-btn animals active" onclick="showCategory('animals')">ğŸ¦ åŠ¨ç‰©</button>
      <button class="category-btn colors" onclick="showCategory('colors')">ğŸ¨ é¢œè‰²</button>
      <button class="category-btn numbers" onclick="showCategory('numbers')">ğŸ”¢ æ•°å­—</button>
      <button class="category-btn fruits" onclick="showCategory('fruits')">ğŸ æ°´æœ</button>
      <button class="category-btn body" onclick="showCategory('body')">ğŸ‘¤ èº«ä½“</button>
    </div>

    <!-- å•è¯ç½‘æ ¼ -->
    <div class="words-grid" id="wordsGrid">
      <!-- å•è¯å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <script src="../data/content.js"></script>
  <script src="../js/main.js"></script>
  <script>
    let currentCategory = 'animals';
    let learnedWords = new Set();

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', () => {
      loadProgress();
      showCategory('animals');
    });

    // æ˜¾ç¤ºç±»åˆ«
    function showCategory(category) {
      SoundManager.playClick();
      currentCategory = category;
      
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // æ¸²æŸ“å•è¯
      renderWords(category);
    }

    // æ¸²æŸ“å•è¯
    function renderWords(category) {
      const grid = document.getElementById('wordsGrid');
      grid.innerHTML = '';
      
      const words = wordsData[category];
      words.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'word-card fade-in';
        card.style.animationDelay = `${index * 0.05}s`;
        
        const wordKey = `${category}_${item.word}`;
        if (learnedWords.has(wordKey)) {
          card.style.border = '3px solid var(--primary-green)';
        }
        
        card.innerHTML = `
          <div class="word-image">${item.icon}</div>
          <div class="word-text">${item.word}</div>
          <div class="word-pronunciation">${item.pronunciation}</div>
        `;
        card.onclick = () => learnWord(item, card, category);
        grid.appendChild(card);
      });
    }

    // å­¦ä¹ å•è¯
    function learnWord(item, card, category) {
      SoundManager.playClick();
      
      // æ’­æ”¾å•è¯å‘éŸ³
      SpeechManager.speak(item.word);
      
      // å»¶è¿Ÿæ’­æ”¾ä¸­æ–‡
      setTimeout(() => {
        SpeechManager.speak(item.chinese, 0.9, 1);
      }, 1200);
      
      // æ ‡è®°ä¸ºå·²å­¦ä¹ 
      const wordKey = `${category}_${item.word}`;
      if (!learnedWords.has(wordKey)) {
        learnedWords.add(wordKey);
        card.style.border = '3px solid var(--primary-green)';
        card.style.transform = 'scale(1.05)';
        
        // æ¯å­¦ä¹ 3ä¸ªå•è¯å¥–åŠ±ä¸€é¢—æ˜Ÿ
        if (learnedWords.size % 3 === 0) {
          ProgressManager.addStars(1);
          showEncouragement();
        }
        
        saveProgress();
        
        setTimeout(() => {
          card.style.transform = '';
        }, 200);
      }
    }

    // æ˜¾ç¤ºé¼“åŠ±
    function showEncouragement() {
      const messages = [
        'å¤ªæ£’äº†ï¼ç»§ç»­åŠ æ²¹ï¼',
        'ä½ çœŸèªæ˜ï¼',
        'åšå¾—å¥½ï¼',
        'è¶…çº§å‰å®³ï¼'
      ];
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, var(--primary-green) 0%, #66BB6A 100%);
        color: white;
        padding: 30px 50px;
        border-radius: 20px;
        font-size: 28px;
        font-weight: 800;
        box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        z-index: 1000;
        animation: fadeIn 0.3s;
      `;
      toast.textContent = `â­ ${randomMessage}`;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 2000);
    }

    // ä¿å­˜è¿›åº¦
    function saveProgress() {
      const totalWords = Object.values(wordsData).flat().length;
      const progress = Math.round((learnedWords.size / totalWords) * 100);
      ProgressManager.setProgress('words', progress);
      localStorage.setItem('kidsEnglish_learnedWords', JSON.stringify([...learnedWords]));
    }

    // åŠ è½½è¿›åº¦
    function loadProgress() {
      const saved = localStorage.getItem('kidsEnglish_learnedWords');
      if (saved) {
        learnedWords = new Set(JSON.parse(saved));
      }
    }

    // è¿”å›å¤§å…
    function goBack() {
      SoundManager.playClick();
      window.location.href = '../hall.html';
    }
  </script>
</body>
</html>
